<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>
  File: README
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!file.README.html";
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><div id='filecontents'>
<h1 id="label-Html5ZipFile">Html5ZipFile</h1>

<p>HTML 5 zip file validation and unpacking.</p>

<h2 id="label-Install+for+development">Install for development</h2>

<p>Perform development with the current version of ruby (2.2.3).</p>

<p>Check out the code:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_git'>git</span> <span class='id identifier rubyid_clone'>clone</span> <span class='id identifier rubyid_git'>git</span><span class='ivar'>@github</span><span class='period'>.</span><span class='id identifier rubyid_com'>com</span><span class='symbol'>:adgear</span><span class='op'>/</span><span class='id identifier rubyid_html5_zip_file'>html5_zip_file</span><span class='period'>.</span><span class='id identifier rubyid_git'>git</span>
</code></pre>

<p>Install dependencies directly (without building a gem):</p>

<pre class="code ruby"><code class="ruby">$ gem install bundler
$ bundle install</code></pre>

<p>Run tests:</p>

<pre class="code ruby"><code class="ruby">$ bundle exec rake test
$ bundle exec ruby -I test test/file_test.rb -n /.*validate_valid_zip.*/</code></pre>

<p>Experiment with the console:</p>

<pre class="code ruby"><code class="ruby">$ bundle exec rake console
irb(main):001:0&gt; HTML5ZipFile::File.open(&#39;test/data/test-ad.zip&#39;) do |f|
irb(main):002:1*
irb(main):003:1* file_valid = f.validate( :unpacked_size =&gt; 700000 )
irb(main):004:1&gt;
irb(main):005:1*   if file_valid
irb(main):006:2&gt;     f.unpack(&#39;/tmp/test_extract&#39;)
irb(main):007:2&gt;   else
irb(main):008:2*     f.failures.each { |failure|  puts(failure) }
irb(main):009:2&gt;   end
irb(main):010:1&gt;
irb(main):011:1* end

Info-ZIP: found version UnZip 5.52
Info-ZIP: CRC check passed (test/data/test-ad.zip)
Info-ZIP: entries parsed (test/data/test-ad.zip)</code></pre>

<p>While developing, you could add testing code at the bottom of a file and
run it:</p>

<pre class="code ruby"><code class="ruby">$ bundle exec ruby lib/html5_zip_file/file.rb</code></pre>

<p>But try writing a doctest directly as a comment of the class/method, and
executing it:</p>

<pre class="code ruby"><code class="ruby">$ bundle exec yard doctest lib/html5_zip_file/file.rb</code></pre>

<p>This is an easy way to produce documentation. See <a
href="#label-Docs+-2F+Doctests">Docs / Doctests</a> for details.</p>

<p>To run the test suite on ruby 1.8.7, build the html5_zip_file_1_8_7 gem,
install it under ruby 1.8.7 and run &#39;rake test&#39;.</p>

<h2 id="label-Install+into+an+application">Install into an application</h2>

<p>Add the appropriate line to your application&#39;s Gemfile:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>html5_zip_file</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:git</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>git://github.com/adgear/html5_zip_file</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_gem'>gem</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>html5_zip_file_1_8_7</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:git</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>git://github.com/adgear/html5_zip_file</span><span class='tstring_end'>&#39;</span></span>
</code></pre>

<p>Execute:</p>

<pre class="code ruby"><code class="ruby">$ bundle install</code></pre>

<p>Integrate into your application:</p>

<pre class="code ruby"><code class="ruby">require &#39;html5_zip_file&#39;

HTML5ZipFile::File.open(&#39;test/data/test-ad.zip&#39;) do |f|
  ...
end</code></pre>

<h2 id="label-Usage">Usage</h2>

<p>For a more sophisticated example, examine the doctest of
<span class='object_link'><a href="HTML5ZipFile/File.html#open-class_method" title="HTML5ZipFile::File.open (method)">HTML5ZipFile::File.open</a></span>, then run it:</p>

<pre class="code ruby"><code class="ruby">$ bundle exec yard doctest lib/html5_zip_file/file.rb

# Running:

I, [2015-12-18T13:57:28.852135 #5871]  INFO -- : Info-ZIP: found version UnZip 5.52
I, [2015-12-18T13:57:28.861000 #5871]  INFO -- : Info-ZIP: CRC check passed (test/data/test-ad.zip)
I, [2015-12-18T13:57:28.864758 #5871]  INFO -- : Info-ZIP: entries parsed (test/data/test-ad.zip)

size_unpacked:
732274

entries:
#&lt;ZipUnpack::Entry:0x007fd0aa24cfc0 @ftype=:file, @name=&quot;index.html&quot;, @size=112&gt;
#&lt;ZipUnpack::Entry:0x007fd0aa24cbb0 @ftype=:directory, @name=&quot;images/&quot;, @size=0&gt;
#&lt;ZipUnpack::Entry:0x007fd0aa24c7c8 @ftype=:file, @name=&quot;images/test.png&quot;, @size=732059&gt;
#&lt;ZipUnpack::Entry:0x007fd0aa24c368 @ftype=:directory, @name=&quot;foo/&quot;, @size=0&gt;
#&lt;ZipUnpack::Entry:0x007fd0aa24c200 @ftype=:file, @name=&quot;foo/index.html&quot;, @size=62&gt;
#&lt;ZipUnpack::Entry:0x007fd0aa247f70 @ftype=:file, @name=&quot;foo/index2.html&quot;, @size=41&gt;

Failed validation checks:
size_unpacked
file_count
path_length
contains_html_file

Finished in 0.020836s, 47.9936 runs/s, 47.9936 assertions/s.

1 runs, 1 assertions, 0 failures, 0 errors, 0 skips</code></pre>

<p>Try editing the doctest.</p>

<p>Change the validation criteria in lib/html5_zip_file/file.rb:</p>

<pre class="code ruby"><code class="ruby">:size_unpacked =&gt; 740000, :file_count =&gt; 6, :path_length =&gt; 15, :contains_html_file =&gt; true</code></pre>

<p>And re-run it:</p>

<pre class="code ruby"><code class="ruby">$ bundle exec yard doctest lib/html5_zip_file/file.rb</code></pre>

<p>Also, try changing file_name from &#39;test-ad.zip&#39; to
&#39;invalid.zip&#39;.</p>

<h3 id="label-Validate">Validate</h3>

<p>See <span class='object_link'><a href="HTML5ZipFile/File.html#validate-instance_method" title="HTML5ZipFile::File#validate (method)">HTML5ZipFile::File#validate</a></span>.</p>

<h3 id="label-Unpack">Unpack</h3>

<p>See <span class='object_link'><a href="HTML5ZipFile/File.html#unpack-instance_method" title="HTML5ZipFile::File#unpack (method)">HTML5ZipFile::File#unpack</a></span>.</p>

<h2 id="label-Gems">Gems</h2>

<p>Separate gemspecs are maintained for &#39;current&#39; ruby and ruby 1.8.7.</p>

<p>Current ruby has rubygems built-in.</p>

<pre class="code ruby"><code class="ruby">$ chruby 2.2.3

$ gem build html5_zip_file.gemspec
Successfully built RubyGem
Name: html5_zip_file
Version: 1.0
File: html5_zip_file-1.0.gem

$ gem install [--dev] html5_zip_file-1.0.gem
Successfully installed html5_zip_file-1.0
Parsing documentation for html5_zip_file-1.0
Installing ri documentation for html5_zip_file-1.0
Done installing documentation for html5_zip_file after 0 seconds

$ gem which html5_zip_file
/Users/MYUSER/.gem/ruby/2.2.3/gems/html5_zip_file-1.0/lib/html5_zip_file.rb

$ irb
irb(main):001:0&gt; require &#39;html5_zip_file&#39;</code></pre>

<p>Ruby 1.8.7 does not have rubygems built-in: install rubygems 1.3.6
manually.</p>

<pre class="code ruby"><code class="ruby">$ chruby 1.8.7

$ gem --version
1.3.6

$ gem build html5_zip_file_1_8_7.gemspec
Successfully built RubyGem
Name: html5_zip_file_1_8_7
Version: 1.0
File: html5_zip_file_1_8_7-1.0.gem

$ gem install [--dev] html5_zip_file_1_8_7-1.0.gem
Successfully installed html5_zip_file_1_8_7-1.0
1 gem installed
Installing ri documentation for html5_zip_file_1_8_7-1.0...
Installing RDoc documentation for html5_zip_file_1_8_7-1.0...

$ gem which html5_zip_file
/Users/MYUSER/.gem/ruby/1.8.7/gems/html5_zip_file_1_8_7-1.0/lib/html5_zip_file.rb

$ irb
irb(main):001:0&gt; require &#39;rubygems&#39;
irb(main):002:0&gt; require &#39;html5_zip_file&#39;
irb(main):003:0&gt; HTML5ZipFile::File
=&gt; HTML5ZipFile::File</code></pre>

<p>Note: if “gem install –dev” deadlocks, just install without –dev and “gem
install X” the development gems manually.</p>

<p>In theory, you could build gems, push them to a repository such as
rubygems.org, and install them in your destination environment with “gem
install XXX”.</p>

<h2 id="label-Docs+-2F+Doctests">Docs / Doctests</h2>

<p>Note: the following don&#39;t work under ruby 1.8.7. Use current ruby if
you want to regenerate the documentation and run the doctests.</p>

<p><a href="http://yardoc.org">yardoc.org</a></p>

<p><a
href="https://github.com/p0deje/yard-doctest">github.com/p0deje/yard-doctest</a></p>

<pre class="code ruby"><code class="ruby">build doc/

$ bundle exec yard doc

live preview:

$ bundle exec yard server --reload

filter:

$ bundle exec yard list --query &#39;@todo&#39;

graph:

$ bundle exec yard graph --full --dependencies | dot -Tpng -o outfile.png

$ bundle exec yard --help

$ bundle exec yard config load_plugins true

$ bundle exec yard config -a autoload_plugins yard-doctest

$ bundle exec yard doctest</code></pre>

<h2 id="label-Packaging+Notes">Packaging Notes</h2>

<p>Subprocess and ZipUnpack are lumped into the html5_zip_file gem for
convenience.</p>

<p>They could be split into their own gems.</p>

<h2 id="label-Contributing">Contributing</h2>

<p>Bug reports and pull requests are welcome on GitHub at <a
href="https://github.com/adgear/html5_zip_file">github.com/adgear/html5_zip_file</a>.</p>

<h2 id="label-License">License</h2>

<p>The gem is available as open source under the terms of the <a
href="http://opensource.org/licenses/MIT">MIT License</a>.</p>
</div></div>

    <div id="footer">
  Generated on Fri Dec 18 18:00:05 2015 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.2.3).
</div>

  </body>
</html>
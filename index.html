<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>
  File: README
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!file.README.html";
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><div id='filecontents'>
<h1 id="label-Html5ZipFile">Html5ZipFile</h1>

<p>HTML 5 zip file validation and unpacking.</p>

<p>Project home: <a
href="https://github.com/adgear/html5_zip_file">github.com/adgear/html5_zip_file</a></p>

<p>Yard docs: <a
href="https://adgear.github.io/html5_zip_file/frames.html">adgear.github.io/html5_zip_file/frames.html</a></p>

<p>Travis CI: <a
href="https://travis-ci.org/adgear/html5_zip_file">travis-ci.org/adgear/html5_zip_file</a></p>

<p><a href="https://travis-ci.org/adgear/html5_zip_file"><img
src="https://travis-ci.org/adgear/html5_zip_file.svg?branch=ruby-1-8-7-compat"></a></p>

<h2 id="label-Install+for+development">Install for development</h2>

<p>Perform development with the current version of ruby (2.2.2).</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_git'>git</span> <span class='id identifier rubyid_clone'>clone</span> <span class='id identifier rubyid_git'>git</span><span class='ivar'>@github</span><span class='period'>.</span><span class='id identifier rubyid_com'>com</span><span class='symbol'>:adgear</span><span class='op'>/</span><span class='id identifier rubyid_html5_zip_file'>html5_zip_file</span><span class='period'>.</span><span class='id identifier rubyid_git'>git</span>
</code></pre>

<p>Install dependencies:</p>

<pre class="code ruby"><code class="ruby">$ gem install bundler
$ bundle install</code></pre>

<p>Run tests:</p>

<pre class="code ruby"><code class="ruby">$ bundle exec rake test
$ bundle exec ruby -Itest test/file_test.rb -n &quot;/.*validate_valid_zip.*/&quot;</code></pre>

<h2 id="label-Usage">Usage</h2>

<p>Run doctests: <span class='object_link'><a href="HTML5ZipFile/File.html#open-class_method" title="HTML5ZipFile::File.open (method)">HTML5ZipFile::File.open</a></span>, <span class='object_link'><a href="HTML5ZipFile/File.html#validate-instance_method" title="HTML5ZipFile::File#validate (method)">HTML5ZipFile::File#validate</a></span> and
<span class='object_link'><a href="HTML5ZipFile/File.html#unpack-instance_method" title="HTML5ZipFile::File#unpack (method)">HTML5ZipFile::File#unpack</a></span>.</p>

<pre class="code ruby"><code class="ruby">$ bundle exec yard doctest -v

# Running:

entries:
#&lt;ZipUnpack::Entry:0x007ff943af05c0 @ftype=:file, @name=&quot;index.html&quot;, @size=112&gt;
#&lt;ZipUnpack::Entry:0x007ff943af0480 @ftype=:directory, @name=&quot;images/&quot;, @size=0&gt;
#&lt;ZipUnpack::Entry:0x007ff943af02c8 @ftype=:file, @name=&quot;images/test.png&quot;, @size=732059&gt;
#&lt;ZipUnpack::Entry:0x007ff943af0138 @ftype=:directory, @name=&quot;foo/&quot;, @size=0&gt;
#&lt;ZipUnpack::Entry:0x007ff943aebf98 @ftype=:file, @name=&quot;foo/index.html&quot;, @size=62&gt;
#&lt;ZipUnpack::Entry:0x007ff943aebea8 @ftype=:file, @name=&quot;foo/index2.html&quot;, @size=41&gt;
HTML5ZipFile::File.open#test_0001_Open a zip file = 0.01 s = .

Failed validation checks:
size_unpacked
file_entries
HTML5ZipFile::File#validate#test_0001_Validate a zip file = 0.01 s = .

/var/folders/_h/d4trcrkn3mv3w307j7_w3xbh0000gn/T/HTML5ZipFile_extract_20160115-67900-hdxmoc
.
..
foo
images
index.html
HTML5ZipFile::File#unpack#test_0001_Unpack a zip file = 0.02 s = .

Finished in 0.055291s, 54.2580 runs/s, 54.2580 assertions/s.

3 runs, 3 assertions, 0 failures, 0 errors, 0 skips</code></pre>

<h2 id="label-Integrate">Integrate</h2>

<p>Add the appropriate line to your application&#39;s Gemfile:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>html5_zip_file</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:git</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>git://github.com/adgear/html5_zip_file</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_gem'>gem</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>html5_zip_file_1_8_7</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:git</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>git://github.com/adgear/html5_zip_file</span><span class='tstring_end'>&#39;</span></span>
</code></pre>

<p>Execute:</p>

<pre class="code ruby"><code class="ruby">$ bundle install</code></pre>

<p>See <a href="file.kitchen_sink.html" title="kitchen_sink.rb">kitchen_sink.rb</a> for an example of how to
actually use the code.</p>

<pre class="code ruby"><code class="ruby">$ bundle exec ruby test/kitchen_sink.rb
I, [2016-01-15T11:15:18.107693 #68031]  INFO -- : Info-ZIP: found version UnZip 5.52
I, [2016-01-15T11:15:18.114819 #68031]  INFO -- : Info-ZIP: CRC check passed
I, [2016-01-15T11:15:18.116761 #68031]  INFO -- : Info-ZIP: entries parsed

size_unpacked: 732274

#&lt;ZipUnpack::Entry:0x007fa89a161170 @ftype=:file, @name=&quot;index.html&quot;, @size=112&gt;
#&lt;ZipUnpack::Entry:0x007fa89a161030 @ftype=:directory, @name=&quot;images/&quot;, @size=0&gt;
#&lt;ZipUnpack::Entry:0x007fa89a160ec8 @ftype=:file, @name=&quot;images/test.png&quot;, @size=732059&gt;
#&lt;ZipUnpack::Entry:0x007fa89a160db0 @ftype=:directory, @name=&quot;foo/&quot;, @size=0&gt;
#&lt;ZipUnpack::Entry:0x007fa89a160c98 @ftype=:file, @name=&quot;foo/index.html&quot;, @size=62&gt;
#&lt;ZipUnpack::Entry:0x007fa89a160ba8 @ftype=:file, @name=&quot;foo/index2.html&quot;, @size=41&gt;

Failed validation checks:
size_unpacked
file_entries
path_length
contains_html_file</code></pre>

<h2 id="label-Docs+-2F+Doctests">Docs / Doctests</h2>

<p>Use current ruby.</p>

<p><a href="http://yardoc.org">yardoc.org</a></p>

<pre class="code ruby"><code class="ruby">$ bundle exec yard help

$ bundle exec yard doc --files test/kitchen_sink.rb

$ bundle exec yard server -r
$ rm -rf .yardoc/
$ bundle exec yard server -r -m
$ bundle exec yard help server

$ bundle exec yard list --query &#39;@todo&#39;

$ bundle exec yard graph --full --dependencies | dot -Tpng -o outfile.png</code></pre>

<p><a
href="https://github.com/p0deje/yard-doctest">github.com/p0deje/yard-doctest</a></p>

<pre class="code ruby"><code class="ruby">$ bundle exec yard config load_plugins true

$ bundle exec yard config -a autoload_plugins yard-doctest

$ bundle exec yard doctest -h

$ bundle exec yard doctest -v</code></pre>

<h2 id="label-External+Dependency">External Dependency</h2>

<p>This gem has one external dependency: the command line program
&#39;unzip&#39;.</p>

<p><a
href="http://www.info-zip.org/UnZip.html">www.info-zip.org/UnZip.html</a></p>

<p>The test suite guarantees compabitibility with unzip v5.52 &amp; v6.0.</p>

<p>Versions currently provided by various distributions (2015-12-21):</p>
<ul><li>
<p>OSX: 5.52 (2005)</p>
</li><li>
<p>Arch: 6.0-11 (4 fixes in 2015)</p>
</li><li>
<p>Gentoo: 6.0-r3 (1 change in 2015)</p>
</li><li>
<p>Debian: 6.0-16 (4 fixes in 2015)</p>
</li><li>
<p>Centos: 6.0-15</p>
</li></ul>

<p>If you use html5_zip_file in an application, you should run the test suite
on a production machine, and “freeze” the unzip version in the OS&#39;s
package manager.</p>

<p>Any time the package manager wants to update unzip, “rake test” should be
run and the gem updated as necessary.</p>

<h2 id="label-Security">Security</h2>

<p>A first layer of security is provided by imposing sensible limits on
:size_unpacked, :entries, :path_length and :path_components via
<span class='object_link'><a href="HTML5ZipFile/File.html#validate-instance_method" title="HTML5ZipFile::File#validate (method)">HTML5ZipFile::File#validate</a></span>.</p>

<h3 id="label-Zip+entry+metadata">Zip entry metadata</h3>

<p>Validation requires running the “unzip -t” and “unzip -l” commands in
subprocesses, and parsing the stdout in a ruby parent process.</p>

<h3 id="label-Zip+unpacking">Zip unpacking</h3>

<p>Currently, the file is unpacked to a target directory with &#39;unzip
-d&#39;.</p>

<p>We rely on unzip&#39;s internal checks to prevent unpacking of files to
locations outside the target directory.</p>

<p>Stronger guarantees could be provided by unpacking in a sandbox:</p>
<ul><li>
<p>Create a temporary sandbox directory with Ruby&#39;s tmpdir module.</p>
</li><li>
<p>Rename the zip file and copy into the sandbox.</p>
</li><li>
<p>Child process (without the ability to write to filesystem locations 
outside the sandbox) runs &#39;unzip -d&#39; to a subdirectory in the 
sandbox.</p>
</li><li>
<p>Once the child terminates, the parent copies the extracted files  from the
sandbox to their final location.</p>
</li><li>
<p>Parent destroys the sandbox.</p>
</li></ul>

<p>Steps to increase the security of the sandbox:</p>

<p>1.) Mount the temporary filesystem on a separate partition.</p>

<p>Determine the location tmpdir uses through irb:</p>

<p>Ruby 2.2.2 on OSX:</p>

<pre class="code ruby"><code class="ruby">$ irb
&gt; require &#39;tmpdir&#39;
&gt; Dir.mktmpdir do |d|
puts d.inspect()
&gt; end
&quot;/var/folders/_h/d4trcrkn3mv3w307j7_w3xbh0000gn/T/d20151223-49143-1mxf2k4&quot;</code></pre>

<p>Ruby 2.2.2 on debian: “/tmp/d20151223-28897-7wfgjm”</p>

<p>2.) Use linux namespaces to prevent filesystem access outside the sandbox
by the subprocess.</p>

<p>3.) Drop unneeded capabilities and put resource utilization limits on the
subprocess.</p>

<h2 id="label-Gems">Gems</h2>

<p>Separate gemspecs are maintained for &#39;current&#39; ruby and ruby 1.8.7.</p>

<p>Current ruby has rubygems built-in.</p>

<pre class="code ruby"><code class="ruby">$ chruby 2.2.2

$ gem build html5_zip_file.gemspec
Successfully built RubyGem
Name: html5_zip_file
Version: 1.0
File: html5_zip_file-1.0.gem

$ gem install [--dev] html5_zip_file-1.0.gem
Successfully installed html5_zip_file-1.0
Parsing documentation for html5_zip_file-1.0
Installing ri documentation for html5_zip_file-1.0
Done installing documentation for html5_zip_file after 0 seconds

$ gem which html5_zip_file
/Users/MYUSER/.gem/ruby/2.2.2/gems/html5_zip_file-1.0/lib/html5_zip_file.rb

$ irb
irb(main):001:0&gt; require &#39;html5_zip_file&#39;</code></pre>

<p>Ruby 1.8.7 does not have rubygems built-in: install rubygems 1.3.6
manually.</p>

<pre class="code ruby"><code class="ruby">$ chruby 1.8.7

$ gem --version
1.3.6

$ gem build html5_zip_file_1_8_7.gemspec
Successfully built RubyGem
Name: html5_zip_file_1_8_7
Version: 1.0
File: html5_zip_file_1_8_7-1.0.gem

$ gem install [--dev] html5_zip_file_1_8_7-1.0.gem
Successfully installed html5_zip_file_1_8_7-1.0
1 gem installed
Installing ri documentation for html5_zip_file_1_8_7-1.0...
Installing RDoc documentation for html5_zip_file_1_8_7-1.0...

$ gem which html5_zip_file
/Users/MYUSER/.gem/ruby/1.8.7/gems/html5_zip_file_1_8_7-1.0/lib/html5_zip_file.rb

$ irb
irb(main):001:0&gt; require &#39;rubygems&#39;
irb(main):002:0&gt; require &#39;html5_zip_file&#39;
irb(main):003:0&gt; HTML5ZipFile::File
=&gt; HTML5ZipFile::File</code></pre>

<p>In theory, you could build gems, push them to a repository such as
rubygems.org, and install them in your destination environment with “gem
install XXX”.</p>

<h2 id="label-License">License</h2>

<p>The gem is available as open source under the terms of the <a
href="http://opensource.org/licenses/MIT">MIT License</a>.</p>
</div></div>

    <div id="footer">
  Generated on Tue Jan 19 15:55:45 2016 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.2.2).
</div>

  </body>
</html>